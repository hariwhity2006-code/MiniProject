<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SEC Fee Management</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'sec-blue': '#005a9c',
              'sec-green': '#28a745',
              'sec-red': '#dc3545',
              'sec-light-blue': '#e3f2fd',
            },
            boxShadow: {
              top: '0 -4px 6px -1px rgb(0 0 0 / 0.1), 0 -2px 4px -2px rgb(0 0 0 / 0.1)',
            }
          },
        },
      }
    </script>

    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Babel for in-browser JSX/TSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone@7.24.7/babel.min.js"></script>

    <!-- React Libraries via Import Map -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.3.1",
    "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>

    <!-- Internal CSS -->
    <style>
      /* Global styles can be added here if needed. */
      /* Currently, styling is primarily handled by Tailwind CSS via CDN. */
      body {
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
      }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>

    <!-- All Application Logic (Internal) -->
    <script type="text/babel" data-type="module">
      import React, { useState, createContext, useContext, useEffect } from 'react';
      import ReactDOM from 'react-dom/client';

      // ========================================================================
      // TYPES (from types.ts)
      // ========================================================================

      const PaymentMethod = {
          CREDIT_CARD: 'Credit Card',
          GOOGLE_PAY: 'Google Pay',
          PHONEPE: 'PhonePe',
      };

      // ========================================================================
      // CONSTANTS (from constants.ts)
      // ========================================================================
      
      const STUDENTS_DATA = [
          { id: '23UCS001', name: 'G.Akash', email: 'g.akash@example.com', phone: '9876543210', password: 'sec@2025', course: 'BE Computer Science Engineering', year: 3, semester: 5, totalFees: 55000, paidAmount: 0, feeBreakdown: { tuition: 40000, hostel: 10000, library: 2000, lab: 3000 } },
          { id: '23UCS002', name: 'P.Dharshan', email: 'p.dharshan@example.com', phone: '9876543211', password: 'sec@2025', course: 'BE Computer Science Engineering', year: 3, semester: 5, totalFees: 52000, paidAmount: 20000, feeBreakdown: { tuition: 38000, hostel: 9000, library: 2000, lab: 3000 } },
          { id: '23UCS003', name: 'P.Dinesh', email: 'p.dinesh@example.com', phone: '9876543212', password: 'sec@2025', course: 'BE Computer Science Engineering', year: 3, semester: 5, totalFees: 48000, paidAmount: 48000, feeBreakdown: { tuition: 35000, hostel: 8000, library: 2000, lab: 3000 } },
          { id: '23UCS004', name: 'S.Hariharan', email: 's.hariharan@example.com', phone: '9876543213', password: 'sec@2025', course: 'BE Computer Science Engineering', year: 3, semester: 5, totalFees: 49500, paidAmount: 10000, feeBreakdown: { tuition: 36500, hostel: 8000, library: 2000, lab: 3000 } },
          { id: '23UCS005', name: 'E.Kaviyarasu', email: 'e.kaviyarasu@example.com', phone: '9876543214', password: 'sec@2025', course: 'BE Computer Science Engineering', year: 3, semester: 5, totalFees: 55500, paidAmount: 0, feeBreakdown: { tuition: 41000, hostel: 9500, library: 2000, lab: 3000 } },
          { id: '23UCS006', name: 'M.Mukunthan', email: 'm.mukunthan@example.com', phone: '9876543215', password: 'sec@2025', course: 'BE Computer Science Engineering', year: 3, semester: 5, totalFees: 50500, paidAmount: 50500, feeBreakdown: { tuition: 37500, hostel: 8000, library: 2000, lab: 3000 } },
          { id: '23UCS007', name: 'S.Navaprashanth', email: 's.navaprashanth@example.com', phone: '9876543216', password: 'sec@2025', course: 'BE Computer Science Engineering', year: 3, semester: 5, totalFees: 49000, paidAmount: 0, feeBreakdown: { tuition: 36000, hostel: 8000, library: 2000, lab: 3000 } },
          { id: '23UCS008', name: 'P.Vignesh', email: 'p.vignesh@example.com', phone: '9876543217', password: 'sec@2025', course: 'BE Computer Science Engineering', year: 3, semester: 5, totalFees: 52500, paidAmount: 25000, feeBreakdown: { tuition: 39000, hostel: 8500, library: 2000, lab: 3000 } },
          { id: '23UCS009', name: 'M.Thulasi Dass', email: 'm.thulasidass@example.com', phone: '9876543218', password: 'sec@2025', course: 'BE Computer Science Engineering', year: 3, semester: 5, totalFees: 50000, paidAmount: 50000, feeBreakdown: { tuition: 37000, hostel: 8000, library: 2000, lab: 3000 } },
          { id: '23UCS010', name: 'Ramachandhiran', email: 'ramachandhiran@example.com', phone: '9876543219', password: 'sec@2025', course: 'BE Computer Science Engineering', year: 3, semester: 5, totalFees: 49800, paidAmount: 0, feeBreakdown: { tuition: 36800, hostel: 8000, library: 2000, lab: 3000 } },
      ];

      const ADMIN_DATA = {
          username: 'admin',
          password: 'admin@123'
      };

      // ========================================================================
      // API (from services/api.ts)
      // ========================================================================

      const api = (() => {
          let students = [...STUDENTS_DATA]; // In-memory store

          const login = (id, pass) => {
              return new Promise((resolve) => {
                  setTimeout(() => {
                      if (id === ADMIN_DATA.username && pass === ADMIN_DATA.password) {
                          resolve({ user: ADMIN_DATA, userType: 'admin' });
                          return;
                      }
                      const student = students.find(s => s.id === id && s.password === pass);
                      if (student) {
                          resolve({ user: student, userType: 'student' });
                      } else {
                          resolve({ user: null, userType: null });
                      }
                  }, 500);
              });
          };

          const registerStudent = (studentData) => {
              return new Promise((resolve) => {
                  setTimeout(() => {
                      const studentExists = students.some(s => s.id === studentData.id || s.email === studentData.email);
                      if (studentExists) {
                          resolve({ success: false, message: 'A student with this Roll Number or Email already exists.' });
                          return;
                      }
                      const newStudent = {
                          ...studentData,
                          course: 'BE Computer Science Engineering',
                          year: 3,
                          semester: 5,
                          totalFees: 51000,
                          paidAmount: 0,
                          feeBreakdown: { tuition: 38000, hostel: 8000, library: 2000, lab: 3000 }
                      };
                      students.push(newStudent);
                      resolve({ success: true, message: 'Registration successful! Please login.' });
                  }, 500);
              });
          };

          const getStudents = () => {
              return new Promise((resolve) => {
                  setTimeout(() => resolve([...students]), 100);
              });
          };

          const updateFee = (studentId, amountPaid) => {
              return new Promise((resolve) => {
                  setTimeout(() => {
                      const studentIndex = students.findIndex(s => s.id === studentId);
                      if (studentIndex > -1) {
                          students[studentIndex] = { ...students[studentIndex], paidAmount: students[studentIndex].paidAmount + amountPaid };
                          resolve([...students]);
                      } else {
                          resolve(null);
                      }
                  }, 100);
              });
          };

          const processPayment = (studentId, amount) => {
              return new Promise((resolve) => {
                  setTimeout(() => {
                      const transactionId = `TXN${Date.now()}`;
                      resolve({ success: true, transactionId });
                  }, 1500);
              });
          };

          return { login, registerStudent, getStudents, updateFee, processPayment };
      })();

      // ========================================================================
      // ICONS (from components/icons/*.tsx)
      // ========================================================================
      
      const UserIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>);
      const EmailIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>);
      const IdCardIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>);
      const PhoneIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>);
      const LogoutIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>);
      const LockIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>);
      const AcademicCapIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M12 14l9-5-9-5-9 5 9 5z" /><path strokeLinecap="round" strokeLinejoin="round" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-5.998 12.078 12.078 0 01.665-6.479L12 14z" /><path strokeLinecap="round" strokeLinejoin="round" d="M12 14v6" /></svg>);
      const CollegeLogo = ({ className = 'h-16 w-16' }) => (<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" className={className}><circle cx="50" cy="50" r="48" fill="#005a9c" stroke="#e3f2fd" strokeWidth="4" /><text x="50%" y="50%" textAnchor="middle" dy=".3em" fill="white" fontSize="40" fontFamily="Arial, sans-serif" fontWeight="bold">SEC</text></svg>);
      const SignatureIcon = ({ className }) => (<svg viewBox="0 0 300 100" className={className} xmlns="http://www.w3.org/2000/svg"><path d="M10,70 Q25,30 50,50 T90,60 Q100,80 120,60 T150,70 Q170,50 190,70 T230,60 Q250,90 270,50 T290,70" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" /></svg>);
      const CreditCardIcon = ({ className = "h-8 w-8 text-blue-500" }) => (<svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>);
      const PhonePeIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>);
      const GooglePayIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" viewBox="0 0 24 24"><path fill="#4285F4" d="M19.6,9.44c0,0.39-0.03,0.77-0.08,1.15H12.2v-2.19h4.22c-0.18-0.71-0.53-1.34-1.04-1.83v-1.42h1.8c1.04,1.02,1.63,2.44,1.63,4.06L19.6,9.44z"/><path fill="#34A853" d="M12.2,20c2.26,0,4.16-0.75,5.55-2.04l-1.8-1.42c-0.75,0.5-1.7,0.8-2.75,0.8c-2.13,0-3.92-1.44-4.57-3.37H4.44v1.46C5.88,18.01,8.79,20,12.2,20z"/><path fill="#FBBC05" d="M7.63,13.96c-0.15-0.45-0.24-0.93-0.24-1.43s0.09-0.98,0.24-1.43V9.64H4.44c-0.43,0.86-0.67,1.82-0.67,2.86s0.24,2,0.67,2.86L7.63,13.96z"/><path fill="#EA4335" d="M12.2,7.47c1.22,0,2.33,0.42,3.2,1.27l1.59-1.59C15.39,5.71,13.89,5,12.2,5C8.79,5,5.88,6.99,4.44,9.64l3.19,2.46C8.28,8.91,10.07,7.47,12.2,7.47z"/></svg>);

      // ========================================================================
      // HELPER FUNCTIONS & COMPONENTS
      // ========================================================================
      
      const getOrdinal = (n) => {
        if (n > 3 && n < 21) return 'th';
        switch (n % 10) {
            case 1: return "st";
            case 2: return "nd";
            case 3: return "rd";
            default: return "th";
        }
      };
      
      const InputField = ({ id, type, placeholder, value, icon, onChange }) => (
          <div className="relative mb-6">
              <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">{icon}</div>
              <input id={id} name={id} type={type} value={value} onChange={onChange} placeholder={placeholder} className="w-full pl-10 pr-4 py-3 bg-white text-black border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sec-blue focus:border-transparent transition-colors" required />
          </div>
      );

      const PaymentMethodButton = ({ method, selected, onClick, children }) => (
          <button onClick={onClick} className={`flex flex-col items-center justify-center p-4 border-2 rounded-lg transition-all duration-200 w-full ${selected ? 'border-blue-500 bg-blue-50' : 'border-gray-300 hover:border-blue-400'}`}>
              {children}
              <span className={`mt-2 font-semibold ${selected ? 'text-blue-600' : 'text-gray-700'}`}>{method}</span>
          </button>
      );
      
      const InfoItem = ({ icon, label, value }) => (
          <div className="flex items-center space-x-4">
              <div className="bg-sec-light-blue p-3 rounded-full">{icon}</div>
              <div><p className="text-sm text-gray-500">{label}</p><p className="font-semibold text-gray-800">{value}</p></div>
          </div>
      );

      const FeeSummaryCard = ({ title, amount, color }) => (
          <div className={`text-white p-6 rounded-xl shadow-lg ${color}`}>
              <p className="text-lg">{title}</p>
              <p className="text-4xl font-bold">₹{amount.toLocaleString('en-IN')}</p>
          </div>
      );

      const FeeStatusBadge = ({ status }) => {
          const colorClasses = { Paid: 'bg-green-100 text-green-800', Pending: 'bg-red-100 text-red-800', Partial: 'bg-yellow-100 text-yellow-800' };
          return <span className={`px-3 py-1 text-sm font-semibold rounded-full ${colorClasses[status]}`}>{status}</span>;
      };

      const MainDashboard = ({ student, dueAmount, setView }) => (
          <>
              <div className="p-4 sm:p-8 space-y-8">
                  <div className="bg-white p-6 rounded-xl shadow-md">
                      <h2 className="text-2xl font-bold text-gray-800 mb-6">Student Information</h2>
                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                          <InfoItem icon={<UserIcon className="w-6 h-6 text-blue-500" />} label="Name" value={student.name} />
                          <InfoItem icon={<IdCardIcon className="w-6 h-6 text-green-500" />} label="Roll Number" value={student.id} />
                          <InfoItem icon={<EmailIcon className="w-6 h-6 text-orange-500" />} label="Email" value={student.email} />
                          <InfoItem icon={<PhoneIcon className="w-6 h-6 text-purple-500" />} label="Phone" value={student.phone} />
                          <InfoItem icon={<AcademicCapIcon className="w-6 h-6 text-indigo-500" />} label="Course & Year" value={`${student.course} - ${student.year}${getOrdinal(student.year)} Year, Sem ${student.semester}`} />
                      </div>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <FeeSummaryCard title="Total Fees" amount={student.totalFees} color="bg-blue-500" />
                      <FeeSummaryCard title="Paid Amount" amount={student.paidAmount} color="bg-green-500" />
                      <FeeSummaryCard title="Due Amount" amount={dueAmount} color="bg-red-500" />
                  </div>
                  <div className="bg-white p-6 rounded-xl shadow-md">
                      <h2 className="text-2xl font-bold text-gray-800 mb-6">Fee Breakdown</h2>
                      <div className="space-y-4">
                          {Object.entries(student.feeBreakdown).map(([key, value]) => (
                              <div key={key} className="flex justify-between items-center p-4 border-b"><p className="text-gray-600 capitalize">{key} Fee</p><p className="font-semibold text-gray-800">₹{value.toLocaleString('en-IN')}</p></div>
                          ))}
                          <div className="flex justify-between items-center p-4 bg-blue-50 rounded-lg"><p className="font-bold text-blue-800 text-lg">Total</p><p className="font-bold text-blue-800 text-lg">₹{student.totalFees.toLocaleString('en-IN')}</p></div>
                      </div>
                  </div>
              </div>
              <div className="sticky bottom-0 bg-white p-4 shadow-top flex justify-center">
                  {dueAmount > 0 ? (
                      <button onClick={() => setView('payment')} className="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-12 rounded-lg shadow-lg transition-transform transform hover:scale-105 duration-300">Pay Now - ₹{dueAmount.toLocaleString('en-IN')}</button>
                  ) : (
                      <button onClick={() => setView('adminSlip')} className="bg-sec-blue hover:bg-blue-700 text-white font-bold py-3 px-12 rounded-lg shadow-lg transition-transform transform hover:scale-105 duration-300">Generate Admin Slip</button>
                  )}
              </div>
          </>
      );

      // ========================================================================
      // AUTH CONTEXT (from contexts/AuthContext.tsx)
      // ========================================================================
      
      const AuthContext = createContext(undefined);

      const AuthProvider = ({ children }) => {
          const [user, setUser] = useState(null);
          const [userType, setUserType] = useState(null);
          const [students, setStudents] = useState([]);

          useEffect(() => {
              api.getStudents().then(setStudents);
          }, []);

          const login = async (id, pass) => {
              const { user: loggedInUser, userType: loggedInUserType } = await api.login(id, pass);
              if (loggedInUser) {
                  setUser(loggedInUser);
                  setUserType(loggedInUserType);
                  if (loggedInUserType === 'admin') {
                      api.getStudents().then(setStudents);
                  }
                  return true;
              }
              return false;
          };

          const logout = () => {
              setUser(null);
              setUserType(null);
          };

          const updateStudentFee = async (studentId, amountPaid) => {
              const updatedStudents = await api.updateFee(studentId, amountPaid);
              if (updatedStudents) {
                  setStudents(updatedStudents);
                  if (user && 'id' in user && user.id === studentId) {
                      const updatedStudent = updatedStudents.find(s => s.id === studentId);
                      if (updatedStudent) {
                          setUser(updatedStudent);
                      }
                  }
              }
          };

          const register = async (studentData) => {
              return await api.registerStudent(studentData);
          };

          const value = { user, userType, students, login, logout, updateStudentFee, register };

          return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
      };

      const useAuth = () => {
          const context = useContext(AuthContext);
          if (context === undefined) {
              throw new Error('useAuth must be used within an AuthProvider');
          }
          return context;
      };

      // ========================================================================
      // COMPONENTS (from components/*.tsx)
      // ========================================================================

      const Header = ({ title }) => {
          const { logout } = useAuth();
          return (
              <header className="bg-white shadow-md p-4 flex justify-between items-center">
                  <h1 className="text-xl md:text-2xl font-bold text-gray-800">{title}</h1>
                  <button onClick={logout} className="flex items-center space-x-2 text-gray-600 hover:text-sec-blue transition-colors duration-200">
                      <LogoutIcon className="w-5 h-5" />
                      <span className="font-semibold">Logout</span>
                  </button>
              </header>
          );
      };

      // ========================================================================
      // PAGES (from pages/*.tsx)
      // ========================================================================

      const LoginPage = ({ onSwitchToRegister }) => {
          const [rollNumber, setRollNumber] = useState('');
          const [password, setPassword] = useState('');
          const [error, setError] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const { login } = useAuth();

          const handleLogin = async (e) => {
              e.preventDefault();
              setError('');
              setIsLoading(true);
              const success = await login(rollNumber, password);
              if (!success) {
                  setError('Invalid credentials. Please try again.');
              }
              setIsLoading(false);
          };

          return (
              <div className="min-h-screen flex items-center justify-center bg-cover bg-center bg-no-repeat" style={{ backgroundImage: "url('https://images.unsplash.com/photo-1541339907198-e08756dedf3f?q=80&w=1920&auto=format&fit=crop')" }}>
                  <div className="absolute inset-0 bg-black opacity-50"></div>
                  <div className="relative bg-white rounded-xl shadow-2xl p-8 sm:p-12 w-full max-w-md m-4">
                      <h1 className="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-8">SEC LOGIN</h1>
                      {error && <p className="bg-red-100 text-red-700 p-3 rounded-md mb-4 text-center">{error}</p>}
                      <form onSubmit={handleLogin}>
                          <div className="relative mb-6">
                              <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                  <UserIcon className="h-5 w-5 text-gray-400" />
                              </div>
                              <input id="rollNumber" type="text" value={rollNumber} onChange={(e) => setRollNumber(e.target.value)} placeholder="Roll Number / Username" className="w-full pl-10 pr-4 py-3 bg-white text-black border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sec-blue focus:border-transparent transition-colors" required />
                          </div>
                          <div className="relative mb-8">
                              <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                  <LockIcon className="h-5 w-5 text-gray-400" />
                              </div>
                              <input id="password" type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="Password" className="w-full pl-10 pr-4 py-3 bg-white text-black border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sec-blue focus:border-transparent transition-colors" required />
                          </div>
                          <button type="submit" disabled={isLoading} className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:shadow-outline transition-transform transform hover:scale-105 duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed">
                              {isLoading ? 'Logging in...' : 'Login'}
                          </button>
                      </form>
                      <p className="text-center text-gray-500 text-sm mt-6">
                          Don't have an account?{' '}
                          <button onClick={onSwitchToRegister} className="font-bold text-sec-blue hover:underline focus:outline-none">
                              Register Here
                          </button>
                      </p>
                  </div>
              </div>
          );
      };

      const RegisterPage = ({ onSwitchToLogin }) => {
          const [formData, setFormData] = useState({ id: '', name: '', email: '', phone: '', password: '', confirmPassword: '' });
          const [error, setError] = useState('');
          const [success, setSuccess] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const { register } = useAuth();

          const handleChange = (e) => {
              setFormData({ ...formData, [e.target.id]: e.target.value });
          };

          const handleRegister = async (e) => {
              e.preventDefault();
              setError('');
              setSuccess('');

              if (formData.password !== formData.confirmPassword) {
                  setError('Passwords do not match.');
                  return;
              }
              if (formData.password.length < 6) {
                  setError('Password must be at least 6 characters long.');
                  return;
              }

              setIsLoading(true);
              const { password, confirmPassword, ...studentData } = formData;
              const result = await register({ ...studentData, password });
              
              if (result.success) {
                  setSuccess(result.message);
                  setTimeout(() => { onSwitchToLogin(); }, 2000);
              } else {
                  setError(result.message);
              }
              setIsLoading(false);
          };

          return (
              <div className="min-h-screen flex items-center justify-center bg-cover bg-center bg-no-repeat" style={{ backgroundImage: "url('https://images.unsplash.com/photo-1541339907198-e08756dedf3f?q=80&w=1920&auto=format&fit=crop')" }}>
                  <div className="absolute inset-0 bg-black opacity-50"></div>
                  <div className="relative bg-white rounded-xl shadow-2xl p-8 sm:p-12 w-full max-w-md m-4">
                      <h1 className="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-8">Create Account</h1>
                      {error && <p className="bg-red-100 text-red-700 p-3 rounded-md mb-4 text-center">{error}</p>}
                      {success && <p className="bg-green-100 text-green-700 p-3 rounded-md mb-4 text-center">{success}</p>}
                      
                      <form onSubmit={handleRegister}>
                          <InputField onChange={handleChange} id="name" type="text" placeholder="Full Name" value={formData.name} icon={<UserIcon className="h-5 w-5 text-gray-400" />} />
                          <InputField onChange={handleChange} id="id" type="text" placeholder="Roll Number" value={formData.id} icon={<IdCardIcon className="h-5 w-5 text-gray-400" />} />
                          <InputField onChange={handleChange} id="email" type="email" placeholder="Email Address" value={formData.email} icon={<EmailIcon className="h-5 w-5 text-gray-400" />} />
                          <InputField onChange={handleChange} id="phone" type="tel" placeholder="Phone Number" value={formData.phone} icon={<PhoneIcon className="h-5 w-5 text-gray-400" />} />
                          <InputField onChange={handleChange} id="password" type="password" placeholder="Password" value={formData.password} icon={<LockIcon className="h-5 w-5 text-gray-400" />} />
                          <InputField onChange={handleChange} id="confirmPassword" type="password" placeholder="Confirm Password" value={formData.confirmPassword} icon={<LockIcon className="h-5 w-5 text-gray-400" />} />
                          
                          <button type="submit" disabled={isLoading || !!success} className="w-full bg-sec-blue hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:shadow-outline transition-transform transform hover:scale-105 duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed">
                              {isLoading ? 'Registering...' : 'Register'}
                          </button>
                      </form>
                      <p className="text-center text-gray-500 text-sm mt-6">
                          Already have an account?{' '}
                          <button onClick={onSwitchToLogin} className="font-bold text-sec-blue hover:underline focus:outline-none">
                              Login Here
                          </button>
                      </p>
                  </div>
              </div>
          );
      };

      const PaymentPage = ({ student, dueAmount, onPaymentSuccess, onBack }) => {
          const [amountToPay, setAmountToPay] = useState(dueAmount);
          const [paymentMethod, setPaymentMethod] = useState(PaymentMethod.GOOGLE_PAY);
          const [upiId, setUpiId] = useState(`${student.name.split(' ').join('').toLowerCase()}${student.id.slice(-4)}@gmail.com`);
          const [cardNumber, setCardNumber] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const [error, setError] = useState('');
          const { updateStudentFee } = useAuth();

          const handleCardNumberChange = (e) => {
              const rawValue = e.target.value.replace(/\s/g, '');
              if (/^\d*$/.test(rawValue) && rawValue.length <= 16) {
                  const formattedValue = rawValue.match(/.{1,4}/g)?.join(' ') || '';
                  setCardNumber(formattedValue);
              }
          };

          const handlePayment = async () => {
              if (amountToPay <= 0 || amountToPay > dueAmount) {
                  setError(`Please enter an amount between ₹1 and ₹${dueAmount}`);
                  return;
              }
              setError('');
              if (paymentMethod === PaymentMethod.CREDIT_CARD) {
                  if (cardNumber.replace(/\s/g, '').length !== 16) {
                      setError('Please enter a valid 16-digit credit card number.');
                      return;
                  }
              }
              setIsLoading(true);
              const result = await api.processPayment(student.id, amountToPay);
              if (result.success) {
                  updateStudentFee(student.id, amountToPay);
                  onPaymentSuccess(amountToPay, result.transactionId, paymentMethod);
              } else {
                  setError('Payment failed. Please try again.');
              }
              setIsLoading(false);
          };

          return (
              <div className="max-w-4xl mx-auto p-4 sm:p-8">
                  <button onClick={onBack} className="mb-6 text-sec-blue font-semibold hover:underline">&larr; Back to Dashboard</button>
                  <div className="bg-white p-6 sm:p-8 rounded-xl shadow-md">
                      <div className="border-b pb-6 mb-6">
                          <h2 className="text-2xl font-bold text-gray-800 mb-4">Payment Summary</h2>
                          <div className="flex justify-between items-center">
                              <span className="text-gray-600 text-lg">Due Amount:</span>
                              <span className="text-red-500 font-bold text-2xl">₹{dueAmount.toLocaleString('en-IN')}</span>
                          </div>
                      </div>
                      <h2 className="text-2xl font-bold text-gray-800 mb-6">Payment Details</h2>
                      {error && <p className="bg-red-100 text-red-700 p-3 rounded-md mb-4 text-center">{error}</p>}
                      <div className="space-y-6">
                          <div>
                              <label htmlFor="amount" className="block text-gray-700 font-semibold mb-2">Amount to Pay</label>
                              <input id="amount" type="number" value={amountToPay} onChange={(e) => setAmountToPay(Number(e.target.value))} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" min="1" max={dueAmount} />
                          </div>
                          <div>
                              <label className="block text-gray-700 font-semibold mb-2">Select Payment Method</label>
                              <div className="grid grid-cols-3 gap-4">
                                  <PaymentMethodButton method={PaymentMethod.CREDIT_CARD} selected={paymentMethod === PaymentMethod.CREDIT_CARD} onClick={() => setPaymentMethod(PaymentMethod.CREDIT_CARD)}><CreditCardIcon /></PaymentMethodButton>
                                  <PaymentMethodButton method={PaymentMethod.GOOGLE_PAY} selected={paymentMethod === PaymentMethod.GOOGLE_PAY} onClick={() => setPaymentMethod(PaymentMethod.GOOGLE_PAY)}><GooglePayIcon/></PaymentMethodButton>
                                  <PaymentMethodButton method={PaymentMethod.PHONEPE} selected={paymentMethod === PaymentMethod.PHONEPE} onClick={() => setPaymentMethod(PaymentMethod.PHONEPE)}><PhonePeIcon /></PaymentMethodButton>
                              </div>
                          </div>
                          {paymentMethod === PaymentMethod.CREDIT_CARD && <div><label htmlFor="cardNumber" className="block text-gray-700 font-semibold mb-2">Credit Card Number</label><div className="relative"><div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><CreditCardIcon className="h-5 w-5 text-gray-400" /></div><input id="cardNumber" type="tel" value={cardNumber} onChange={handleCardNumberChange} placeholder="0000 0000 0000 0000" className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono tracking-widest" required /></div></div>}
                          {(paymentMethod === PaymentMethod.GOOGLE_PAY || paymentMethod === PaymentMethod.PHONEPE) && <div><label htmlFor="upiId" className="block text-gray-700 font-semibold mb-2">UPI ID</label><input id="upiId" type="text" value={upiId} onChange={(e) => setUpiId(e.target.value)} className="w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg text-blue-800 font-mono" readOnly /></div>}
                          <button onClick={handlePayment} disabled={isLoading} className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-4 rounded-lg shadow-lg transition-transform transform hover:scale-105 duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed text-lg">{isLoading ? 'Processing...' : `Pay ₹${amountToPay.toLocaleString('en-IN')}`}</button>
                      </div>
                  </div>
              </div>
          );
      };
      
      const ReceiptPage = ({ student, paymentDetails, onBack }) => {
          const receiptDate = new Date();
          const dueAmount = student.totalFees - student.paidAmount;

          const handleDownload = () => {
              const receiptElement = document.getElementById('receipt');
              if (receiptElement && typeof jspdf !== 'undefined' && typeof html2canvas !== 'undefined') {
                  const { jsPDF } = jspdf;
                  const originalInlineStyle = receiptElement.style.cssText;
                  receiptElement.style.width = '896px';
                  html2canvas(receiptElement, { scale: 2, useCORS: true, logging: false, windowWidth: 896 }).then(canvas => {
                      receiptElement.style.cssText = originalInlineStyle;
                      const imgData = canvas.toDataURL('image/png');
                      const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                      const pdfWidth = pdf.internal.pageSize.getWidth();
                      const imgHeightInPdf = canvas.height * pdfWidth / canvas.width;
                      pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, imgHeightInPdf);
                      pdf.save(`SEC-Receipt-${student.id}.pdf`);
                  }).catch(err => {
                      receiptElement.style.cssText = originalInlineStyle;
                      console.error("PDF generation failed:", err);
                  });
              }
          };

          return (
              <>
                  <div className="max-w-4xl mx-auto p-4 sm:p-8 pb-32">
                      <div className="bg-white p-6 sm:p-10 rounded-xl shadow-lg border border-gray-200" id="receipt">
                          <div className="text-center mb-8 border-b pb-6">
                              <h1 className="text-3xl font-bold text-green-600">Payment Successful!</h1>
                              <p className="text-gray-500 mt-2">Your fee payment has been processed successfully.</p>
                          </div>
                          <div className="flex flex-col sm:flex-row justify-between items-start mb-8">
                              <div className="mb-4 sm:mb-0"><h2 className="text-2xl font-semibold text-gray-800">Receipt</h2><p className="text-gray-500">SEC Fee Management</p></div>
                              <div className="text-left sm:text-right w-full sm:w-auto"><p className="font-semibold">Transaction ID:</p><p className="text-gray-600 text-sm break-all">{paymentDetails.transactionId}</p><p className="font-semibold mt-2">Date:</p><p className="text-gray-600 text-sm">{receiptDate.toLocaleString()}</p></div>
                          </div>
                          <div className="bg-sec-light-blue p-6 rounded-lg mb-8">
                              <h3 className="font-semibold text-lg mb-4 text-sec-blue">Student Details</h3>
                              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                  <div><span className="font-medium text-gray-600">Name:</span> <span className="font-semibold text-sec-blue">{student.name}</span></div>
                                  <div><span className="font-medium text-gray-600">Roll Number:</span> <span className="font-semibold text-sec-blue">{student.id}</span></div>
                                  <div><span className="font-medium text-gray-600">Email:</span> <span className="font-semibold text-sec-blue">{student.email}</span></div>
                                  <div><span className="font-medium text-gray-600">Course:</span> <span className="font-semibold text-sec-blue">{`${student.course} - ${student.year}${getOrdinal(student.year)} Year, Sem ${student.semester}`}</span></div>
                              </div>
                          </div>
                          <div>
                              <h3 className="font-semibold text-lg mb-4 text-sec-blue">Payment Summary</h3>
                              <div className="space-y-3">
                                  <div className="flex justify-between items-center border-b pb-3"><p className="text-gray-600">Amount Paid</p><p className="font-bold text-green-600 text-xl">₹{paymentDetails.amount.toLocaleString('en-IN')}</p></div>
                                  <div className="flex justify-between items-center border-b pb-3"><p className="text-gray-600">Payment Method</p><p className="font-semibold">{paymentDetails.method}</p></div>
                                  <div className="flex justify-between items-center border-b pb-3"><p className="text-gray-600">Total Fees</p><p className="font-semibold">₹{student.totalFees.toLocaleString('en-IN')}</p></div>
                                  <div className="flex justify-between items-center border-b pb-3"><p className="text-gray-600">Total Paid Amount</p><p className="font-semibold">₹{student.paidAmount.toLocaleString('en-IN')}</p></div>
                                  <div className="flex justify-between items-center bg-gray-100 p-4 rounded-lg"><p className="font-bold text-gray-800">Balance Due</p><p className="font-bold text-red-500 text-xl">₹{dueAmount.toLocaleString('en-IN')}</p></div>
                              </div>
                          </div>
                          <div className="mt-8 text-center text-sm text-gray-500"><p>An email receipt has been sent to {student.email}.</p><p>This is a computer-generated receipt and does not require a signature.</p></div>
                      </div>
                  </div>
                  <div className="sticky bottom-0 bg-white p-4 shadow-top flex flex-col sm:flex-row justify-center items-center gap-4 print:hidden">
                      <button onClick={onBack} className="w-full sm:w-auto order-2 sm:order-1 text-gray-700 font-semibold py-3 px-8 rounded-lg border border-gray-300 hover:bg-gray-100 transition-colors">Back to Dashboard</button>
                      <button onClick={handleDownload} className="w-full sm:w-auto order-1 sm:order-2 bg-sec-blue hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition">Download Receipt</button>
                  </div>
              </>
          );
      };

      const AdminSlipPage = ({ student, onBack }) => {
          const issueDate = new Date();

          const handleDownload = () => {
              const slipElement = document.getElementById('admin-slip');
              if (slipElement && typeof jspdf !== 'undefined' && typeof html2canvas !== 'undefined') {
                  const { jsPDF } = jspdf;
                  const originalInlineStyle = slipElement.style.cssText;
                  slipElement.style.width = '896px';
                  html2canvas(slipElement, { scale: 2, useCORS: true, logging: false, windowWidth: 896 }).then(canvas => {
                      slipElement.style.cssText = originalInlineStyle;
                      const imgData = canvas.toDataURL('image/png');
                      const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                      const pdfWidth = pdf.internal.pageSize.getWidth();
                      const imgHeightInPdf = canvas.height * pdfWidth / canvas.width;
                      pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, imgHeightInPdf);
                      pdf.save(`SEC-Admin-Slip-${student.id}.pdf`);
                  }).catch(err => {
                      slipElement.style.cssText = originalInlineStyle;
                      console.error("PDF generation failed:", err);
                  });
              }
          };

          return (
              <>
                  <div className="max-w-4xl mx-auto p-4 sm:p-8 pb-32">
                      <div className="bg-white p-6 sm:p-10 rounded-xl shadow-lg border border-gray-200" id="admin-slip">
                          <div className="flex flex-col sm:flex-row justify-between items-center mb-8 border-b-2 border-sec-blue pb-6">
                              <div className="flex items-center space-x-4">
                                  <CollegeLogo className="h-20 w-20" />
                                  <div>
                                      <h1 className="text-2xl sm:text-3xl font-bold text-sec-blue">Sengunthar Engineering College</h1>
                                      <p className="text-gray-600">Tiruchengode, Namakkal (Dt), Tamilnadu - 637205</p>
                                  </div>
                              </div>
                          </div>
                          <div className="text-center mb-8"><h2 className="text-xl font-bold uppercase tracking-wider text-gray-800">Admin Slip / No Dues Certificate</h2></div>
                          <div className="text-right mb-8"><p className="font-semibold">Date of Issue:</p><p className="text-gray-700">{issueDate.toLocaleDateString('en-GB')}</p></div>
                          <div className="bg-sec-light-blue p-6 rounded-lg mb-8">
                              <h3 className="font-semibold text-lg mb-4 text-sec-blue">Student Details</h3>
                              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 text-lg">
                                  <div><span className="font-medium text-gray-600">Name:</span> <span className="font-semibold text-sec-blue">{student.name}</span></div>
                                  <div><span className="font-medium text-gray-600">Roll No:</span> <span className="font-semibold text-sec-blue">{student.id}</span></div>
                                  <div className="col-span-full"><span className="font-medium text-gray-600">Course:</span> <span className="font-semibold text-sec-blue">{`${student.course} - ${student.year}${getOrdinal(student.year)} Year, Sem ${student.semester}`}</span></div>
                              </div>
                          </div>
                          <div className="text-center my-10"><p className="text-lg text-gray-700 leading-relaxed">This is to certify that the student mentioned above has paid all the fees, including tuition, hostel, and other miscellaneous charges for the academic period.</p><p className="text-xl font-bold text-green-600 mt-4">All Dues Cleared.</p></div>
                          <div className="mt-24 text-right"><div className="inline-block text-center"><SignatureIcon className="w-48 h-12 text-gray-800" /><div className="w-48 border-t-2 border-gray-400 mt-1"></div><p className="font-semibold text-gray-700 mt-2">Authorised Signature</p><p className="text-sm text-gray-500">Accounts Department</p></div></div>
                          <div className="mt-12 text-center text-sm text-gray-500"><p>This is a computer-generated slip and does not require a physical signature for validation if downloaded from the official portal.</p></div>
                      </div>
                  </div>
                  <div className="sticky bottom-0 bg-white p-4 shadow-top flex flex-col sm:flex-row justify-center items-center gap-4 print:hidden">
                      <button onClick={onBack} className="w-full sm:w-auto order-2 sm:order-1 text-gray-700 font-semibold py-3 px-8 rounded-lg border border-gray-300 hover:bg-gray-100 transition-colors">Back to Dashboard</button>
                      <button onClick={handleDownload} className="w-full sm:w-auto order-1 sm:order-2 bg-sec-blue hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition">Download Slip</button>
                  </div>
              </>
          );
      };

      const FullPaymentSuccessPage = ({ student, paymentDetails, onBack }) => {
          const receiptDate = new Date();
          const issueDate = new Date();
          
          const handleDownload = (elementId, fileName) => {
              const elementToCapture = document.getElementById(elementId);
              if (elementToCapture && typeof jspdf !== 'undefined' && typeof html2canvas !== 'undefined') {
                  const { jsPDF } = jspdf;
                  const originalInlineStyle = elementToCapture.style.cssText;
                  elementToCapture.style.width = '896px';
                  html2canvas(elementToCapture, { scale: 2, useCORS: true, logging: false, windowWidth: 896 }).then(canvas => {
                      elementToCapture.style.cssText = originalInlineStyle;
                      const imgData = canvas.toDataURL('image/png');
                      const pdf = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                      const pdfWidth = pdf.internal.pageSize.getWidth();
                      const imgHeightInPdf = canvas.height * pdfWidth / canvas.width;
                      pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, imgHeightInPdf);
                      pdf.save(fileName);
                  }).catch(err => {
                      elementToCapture.style.cssText = originalInlineStyle;
                      console.error("PDF generation failed:", err);
                  });
              }
          };

          return (
              <>
                  <div className="max-w-4xl mx-auto p-4 sm:p-8 pb-32">
                      <div className="bg-white p-6 sm:p-10 rounded-xl shadow-lg border border-gray-200 mb-8"><div className="text-center"><h1 className="text-3xl font-bold text-green-600">Payment Successful!</h1><p className="text-gray-600 mt-2 text-lg">Congratulations, all your dues have been cleared.</p></div></div>
                      <div className="bg-white p-6 sm:p-10 rounded-xl shadow-lg border border-gray-200 mb-8" id="receipt-section">
                          <div className="flex flex-col sm:flex-row justify-between items-start mb-8">
                              <div><h2 className="text-2xl font-semibold text-gray-800">Final Payment Receipt</h2><p className="text-gray-500">SEC Fee Management</p></div>
                              <div className="text-left sm:text-right w-full sm:w-auto mt-4 sm:mt-0"><p className="font-semibold">Transaction ID:</p><p className="text-gray-600 text-sm break-all">{paymentDetails.transactionId}</p><p className="font-semibold mt-2">Date:</p><p className="text-gray-600 text-sm">{receiptDate.toLocaleString()}</p></div>
                          </div>
                          <div className="bg-sec-light-blue p-6 rounded-lg mb-8">
                              <h3 className="font-semibold text-lg mb-4 text-sec-blue">Student Details</h3>
                              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                  <div><span className="font-medium text-gray-600">Name:</span> <span className="font-semibold text-sec-blue">{student.name}</span></div>
                                  <div><span className="font-medium text-gray-600">Roll Number:</span> <span className="font-semibold text-sec-blue">{student.id}</span></div>
                                  <div className="col-span-full"><span className="font-medium text-gray-600">Course:</span> <span className="font-semibold text-sec-blue">{`${student.course} - ${student.year}${getOrdinal(student.year)} Year, Sem ${student.semester}`}</span></div>
                              </div>
                          </div>
                          <div>
                              <h3 className="font-semibold text-lg mb-4 text-sec-blue">Payment Summary</h3>
                              <div className="space-y-3">
                                  <div className="flex justify-between items-center border-b pb-3"><p className="text-gray-600">Amount Paid</p><p className="font-bold text-green-600 text-xl">₹{paymentDetails.amount.toLocaleString('en-IN')}</p></div>
                                  <div className="flex justify-between items-center border-b pb-3"><p className="text-gray-600">Payment Method</p><p className="font-semibold">{paymentDetails.method}</p></div>
                                  <div className="flex justify-between items-center bg-gray-100 p-4 rounded-lg"><p className="font-bold text-gray-800">Balance Due</p><p className="font-bold text-green-600 text-xl">₹0</p></div>
                              </div>
                          </div>
                      </div>
                      <div className="bg-white p-6 sm:p-10 rounded-xl shadow-lg border border-gray-200" id="admin-slip-section">
                          <div className="flex flex-col sm:flex-row justify-between items-center mb-8 border-b-2 border-sec-blue pb-6"><div className="flex items-center space-x-4"><CollegeLogo className="h-20 w-20" /><div><h1 className="text-2xl sm:text-3xl font-bold text-sec-blue">Sengunthar Engineering College</h1><p className="text-gray-600">Tiruchengode, Namakkal (Dt), Tamilnadu - 637205</p></div></div></div>
                          <div className="text-center mb-8"><h2 className="text-xl font-bold uppercase tracking-wider text-gray-800">Admin Slip / No Dues Certificate</h2></div>
                          <div className="text-right mb-8"><p className="font-semibold">Date of Issue:</p><p className="text-gray-700">{issueDate.toLocaleDateString('en-GB')}</p></div>
                          <div className="bg-sec-light-blue p-6 rounded-lg mb-8">
                              <h3 className="font-semibold text-lg mb-4 text-sec-blue">Student Details</h3>
                              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 text-lg">
                                  <div><span className="font-medium text-gray-600">Name:</span> <span className="font-semibold text-sec-blue">{student.name}</span></div>
                                  <div><span className="font-medium text-gray-600">Roll No:</span> <span className="font-semibold text-sec-blue">{student.id}</span></div>
                                  <div className="col-span-full"><span className="font-medium text-gray-600">Course:</span> <span className="font-semibold text-sec-blue">{`${student.course} - ${student.year}${getOrdinal(student.year)} Year, Sem ${student.semester}`}</span></div>
                              </div>
                          </div>
                          <div className="text-center my-10"><p className="text-lg text-gray-700 leading-relaxed">This is to certify that the student mentioned above has paid all the fees for the academic period.</p><p className="text-xl font-bold text-green-600 mt-4">All Dues Cleared.</p></div>
                          <div className="mt-24 text-right"><div className="inline-block text-center"><SignatureIcon className="w-48 h-12 text-gray-800" /><div className="w-48 border-t-2 border-gray-400 mt-1"></div><p className="font-semibold text-gray-700 mt-2">Authorised Signature</p><p className="text-sm text-gray-500">Accounts Department</p></div></div>
                      </div>
                  </div>
                  <div className="sticky bottom-0 bg-white p-4 shadow-top flex flex-col sm:flex-row justify-center items-center gap-4 print:hidden">
                      <button onClick={onBack} className="w-full sm:w-auto order-3 sm:order-1 text-gray-700 font-semibold py-3 px-6 rounded-lg border border-gray-300 hover:bg-gray-100 transition-colors">Back to Dashboard</button>
                      <button onClick={() => handleDownload('receipt-section', `SEC-Receipt-${student.id}.pdf`)} className="w-full sm:w-auto order-2 sm:order-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition">Download Receipt</button>
                      <button onClick={() => handleDownload('admin-slip-section', `SEC-Admin-Slip-${student.id}.pdf`)} className="w-full sm:w-auto order-1 sm:order-3 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition">Download Admin Slip</button>
                  </div>
              </>
          );
      };

      const StudentDashboard = () => {
          const { user } = useAuth();
          const [view, setView] = useState('dashboard');
          const [paymentDetails, setPaymentDetails] = useState(null);

          if (!user || !('id' in user)) return null;
          const student = user;
          const dueAmount = student.totalFees - student.paidAmount;

          const handlePaymentSuccess = (amount, transactionId, method) => {
              const newPaidAmount = student.paidAmount + amount;
              setPaymentDetails({ amount, transactionId, method });
              if (newPaidAmount >= student.totalFees) {
                  setView('fullPaymentSuccess');
              } else {
                  setView('receipt');
              }
          };

          return (
              <div className="flex flex-col min-h-screen">
                  <Header title="SEC Fee Management" />
                  <main className="flex-grow">
                      {view === 'dashboard' && <MainDashboard student={student} dueAmount={dueAmount} setView={setView} />}
                      {view === 'payment' && <PaymentPage student={student} dueAmount={dueAmount} onPaymentSuccess={handlePaymentSuccess} onBack={() => setView('dashboard')} />}
                      {view === 'receipt' && paymentDetails && <ReceiptPage student={student} paymentDetails={paymentDetails} onBack={() => setView('dashboard')} />}
                      {view === 'adminSlip' && <AdminSlipPage student={student} onBack={() => setView('dashboard')} />}
                      {view === 'fullPaymentSuccess' && paymentDetails && <FullPaymentSuccessPage student={student} paymentDetails={paymentDetails} onBack={() => setView('dashboard')} />}
                  </main>
              </div>
          );
      };

      const AdminDashboard = () => {
          const { students } = useAuth();
          const totalFees = students.reduce((acc, s) => acc + s.totalFees, 0);
          const totalCollected = students.reduce((acc, s) => acc + s.paidAmount, 0);
          const totalDue = totalFees - totalCollected;

          const getStatus = (student) => {
              if (student.paidAmount >= student.totalFees) return 'Paid';
              if (student.paidAmount === 0) return 'Pending';
              return 'Partial';
          };

          const exportToCSV = () => {
              const headers = ['Roll Number', 'Name', 'Email', 'Total Fees', 'Paid Amount', 'Due Amount', 'Status'];
              const csvRows = [headers.join(',')];
              students.forEach(student => {
                  const due = student.totalFees - student.paidAmount;
                  const row = [student.id, student.name, student.email, student.totalFees, student.paidAmount, due, getStatus(student)];
                  csvRows.push(row.join(','));
              });
              const csvString = csvRows.join('\n');
              const blob = new Blob([csvString], { type: 'text/csv' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = 'student_fees_report.csv';
              a.click();
              URL.revokeObjectURL(url);
          };

          return (
              <div className="flex flex-col min-h-screen">
                  <Header title="Admin Dashboard - SEC Fees" />
                  <main className="flex-grow p-4 sm:p-8">
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                          <div className="bg-blue-500 text-white p-6 rounded-xl shadow-lg"><p className="text-lg">Total Fees</p><p className="text-4xl font-bold">₹{totalFees.toLocaleString('en-IN')}</p></div>
                          <div className="bg-green-500 text-white p-6 rounded-xl shadow-lg"><p className="text-lg">Total Collected</p><p className="text-4xl font-bold">₹{totalCollected.toLocaleString('en-IN')}</p></div>
                          <div className="bg-red-500 text-white p-6 rounded-xl shadow-lg"><p className="text-lg">Total Due</p><p className="text-4xl font-bold">₹{totalDue.toLocaleString('en-IN')}</p></div>
                      </div>
                      <div className="bg-white p-6 rounded-xl shadow-md">
                          <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold text-gray-800">All Students</h2><button onClick={exportToCSV} className="bg-sec-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">Export to CSV</button></div>
                          <div className="overflow-x-auto">
                              <table className="w-full text-left">
                                  <thead className="bg-gray-50"><tr><th className="p-4 font-semibold text-gray-600">Roll No</th><th className="p-4 font-semibold text-gray-600">Name</th><th className="p-4 font-semibold text-gray-600">Total Fees</th><th className="p-4 font-semibold text-gray-600">Paid</th><th className="p-4 font-semibold text-gray-600">Due</th><th className="p-4 font-semibold text-gray-600 text-center">Status</th></tr></thead>
                                  <tbody>
                                      {students.map(student => {
                                          const due = student.totalFees - student.paidAmount;
                                          return (<tr key={student.id} className="border-b hover:bg-gray-50"><td className="p-4 font-medium text-gray-800">{student.id}</td><td className="p-4 text-gray-700">{student.name}</td><td className="p-4 text-gray-700">₹{student.totalFees.toLocaleString('en-IN')}</td><td className="p-4 text-green-600 font-semibold">₹{student.paidAmount.toLocaleString('en-IN')}</td><td className="p-4 text-red-600 font-semibold">₹{due.toLocaleString('en-IN')}</td><td className="p-4 text-center"><FeeStatusBadge status={getStatus(student)} /></td></tr>);
                                      })}
                                  </tbody>
                              </table>
                          </div>
                      </div>
                  </main>
              </div>
          );
      };

      // ========================================================================
      // APP & RENDER (from App.tsx and index.tsx)
      // ========================================================================
      
      const AppContent = () => {
          const { user, userType } = useAuth();
          const [authView, setAuthView] = useState('login');

          if (!user) {
              if (authView === 'login') {
                  return <LoginPage onSwitchToRegister={() => setAuthView('register')} />;
              }
              return <RegisterPage onSwitchToLogin={() => setAuthView('login')} />;
          }

          if (userType === 'student') {
              return <StudentDashboard />;
          }

          if (userType === 'admin') {
              return <AdminDashboard />;
          }

          return <LoginPage onSwitchToRegister={() => setAuthView('register')} />;
      };

      const App = () => {
          return (
              <AuthProvider>
                  <div className="min-h-screen bg-cover bg-center bg-fixed" style={{ backgroundImage: "url('https://images.unsplash.com/photo-1562774053-701939374585?q=80&w=1920&auto=format&fit=crop')" }}>
                      <div className="min-h-screen bg-gray-50/95 backdrop-blur-sm">
                          <AppContent />
                      </div>
                  </div>
              </AuthProvider>
          );
      };

      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>